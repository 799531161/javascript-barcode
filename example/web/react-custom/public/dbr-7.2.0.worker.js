'use strict';let dbrBWasmDebug,dbrEngineResourcePath,dbrVersion,dbrProductKeys,dbrBRuntimeKeys,dbrDomain,dbrBNewDevice=!1,dbrBUseFullFeature=!1,dbrUUID,dbrLicenseServer="https://dbrjsauth.dynamsoft.com/v2/",dbrPromiseGetLicense,dbrLicenseInfo,dbrPromisePostConsumption=Promise.resolve();
!function(p){"object"==typeof exports&&"undefined"!=typeof module?module.exports=p():"function"==typeof define&&define.amd?define([],p):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=p()}(function(){return function r(c,f,l){function g(a,v){if(!f[a]){if(!c[a]){var m="function"==typeof require&&require;if(!v&&m)return m(a,!0);if(t)return t(a,!0);v=Error("Cannot find module '"+a+"'");throw v.code="MODULE_NOT_FOUND",v;}v=f[a]={exports:{}};
c[a][0].call(v.exports,function(f){return g(c[a][1][f]||f)},v,v.exports,r,c,f,l)}return f[a].exports}for(var t="function"==typeof require&&require,a=0;a<l.length;a++)g(l[a]);return g}({1:[function(c,f,l){(function(c){function g(){w=!0;for(var a,c,f=u.length;f;){c=u;u=[];for(a=-1;++a<f;)c[a]();f=u.length}w=!1}var t=c.MutationObserver||c.WebKitMutationObserver;if(t){var a=0;t=new t(g);var m=c.document.createTextNode("");t.observe(m,{characterData:!0});var l=function(){m.data=a=++a%2}}else if(c.setImmediate||
void 0===c.MessageChannel)l="document"in c&&"onreadystatechange"in c.document.createElement("script")?function(){var a=c.document.createElement("script");a.onreadystatechange=function(){g();a.onreadystatechange=null;a.parentNode.removeChild(a);a=null};c.document.documentElement.appendChild(a)}:function(){setTimeout(g,0)};else{var r=new c.MessageChannel;r.port1.onmessage=g;l=function(){r.port2.postMessage(0)}}var w,u=[];f.exports=function(a){1!==u.push(a)||w||l()}}).call(this,"undefined"!=typeof global?
global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(c,f,l){function r(){}function g(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=G;this.queue=[];this.outcome=void 0;a!==r&&v(this,a)}function t(a,c,f){this.promise=a;"function"==typeof c&&(this.onFulfilled=c,this.callFulfilled=this.otherCallFulfilled);"function"==typeof f&&(this.onRejected=f,this.callRejected=this.otherCallRejected)}function a(a,c,f){w(function(){try{var g=
c(f)}catch(z){return u.reject(a,z)}g===a?u.reject(a,new TypeError("Cannot resolve promise with itself")):u.resolve(a,g)})}function m(a){var c=a&&a.then;if(a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof c)return function(){c.apply(a,arguments)}}function v(a,c){function f(c){m||(m=!0,u.reject(a,c))}function g(c){m||(m=!0,u.resolve(a,c))}var m=!1,l=K(function(){c(g,f)});"error"===l.status&&f(l.value)}function K(a,c){var f={};try{f.value=a(c),f.status="success"}catch(O){f.status="error",
f.value=O}return f}var w=c(1),u={},D=["REJECTED"],A=["FULFILLED"],G=["PENDING"];f.exports=g;g.prototype.catch=function(a){return this.then(null,a)};g.prototype.then=function(c,f){if("function"!=typeof c&&this.state===A||"function"!=typeof f&&this.state===D)return this;var g=new this.constructor(r);this.state!==G?a(g,this.state===A?c:f,this.outcome):this.queue.push(new t(g,c,f));return g};t.prototype.callFulfilled=function(a){u.resolve(this.promise,a)};t.prototype.otherCallFulfilled=function(c){a(this.promise,
this.onFulfilled,c)};t.prototype.callRejected=function(a){u.reject(this.promise,a)};t.prototype.otherCallRejected=function(c){a(this.promise,this.onRejected,c)};u.resolve=function(a,c){var f=K(m,c);if("error"===f.status)return u.reject(a,f.value);if(f=f.value)v(a,f);else{a.state=A;a.outcome=c;f=-1;for(var g=a.queue.length;++f<g;)a.queue[f].callFulfilled(c)}return a};u.reject=function(a,c){a.state=D;a.outcome=c;for(var f=-1,g=a.queue.length;++f<g;)a.queue[f].callRejected(c);return a};g.resolve=function(a){return a instanceof
this?a:u.resolve(new this(r),a)};g.reject=function(a){var c=new this(r);return u.reject(c,a)};g.all=function(a){function c(a,c){f.resolve(a).then(function(a){l[c]=a;++t!==g||m||(m=!0,u.resolve(w,l))},function(a){m||(m=!0,u.reject(w,a))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var g=a.length,m=!1;if(!g)return this.resolve([]);for(var l=Array(g),t=0,v=-1,w=new this(r);++v<g;)c(a[v],v);return w};g.race=function(a){function c(a){f.resolve(a).then(function(a){m||
(m=!0,u.resolve(t,a))},function(a){m||(m=!0,u.reject(t,a))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var g=a.length,m=!1;if(!g)return this.resolve([]);for(var l=-1,t=new this(r);++l<g;)c(a[l]);return t}},{1:1}],3:[function(c,f,l){f="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};"function"!=typeof f.Promise&&(f.Promise=c(2))},{2:2}],4:[function(c,f,l){function r(b,
d){b=b||[];d=d||{};try{return new Blob(b,d)}catch(k){if("TypeError"!==k.name)throw k;for(var e=new ("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),q=0;q<b.length;q+=1)e.append(b[q]);return e.getBlob(d.type)}}function g(b,d){d&&b.then(function(b){d(null,b)},function(b){d(b)})}function t(b,d,e){"function"==typeof d&&b.then(d);"function"==typeof e&&b.catch(e)}function a(b){return"string"!=
typeof b&&(console.warn(b+" used as a key, but it is not a string."),b=String(b)),b}function m(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function v(b){return(new n(function(d){var e=b.transaction(Q,L),q=r([""]);e.objectStore(Q).put(q,"key");e.onabort=function(b){b.preventDefault();b.stopPropagation();d(!1)};e.oncomplete=function(){var b=navigator.userAgent.match(/Chrome\/(\d+)/),e=navigator.userAgent.match(/Edge\//);d(e||!b||43<=parseInt(b[1],
10))}})).catch(function(){return!1})}function K(b){return"boolean"==typeof R?n.resolve(R):v(b).then(function(b){return R=b})}function w(b){b=x[b.name];var d={};d.promise=new n(function(b,q){d.resolve=b;d.reject=q});b.deferredOperations.push(d);b.dbReady?b.dbReady=b.dbReady.then(function(){return d.promise}):b.dbReady=d.promise}function u(b){if(b=x[b.name].deferredOperations.pop())return b.resolve(),b.promise}function D(b,d){if(b=x[b.name].deferredOperations.pop())return b.reject(d),b.promise}function A(b,
d){return new n(function(e,q){if(x[b.name]=x[b.name]||Z(),b.db){if(!d)return e(b.db);w(b);b.db.close()}var a=[b.name];d&&a.push(b.version);var h=H.open.apply(H,a);d&&(h.onupgradeneeded=function(d){var e=h.result;try{e.createObjectStore(b.storeName),1>=d.oldVersion&&e.createObjectStore(Q)}catch(y){if("ConstraintError"!==y.name)throw y;console.warn('The database "'+b.name+'" has been upgraded from version '+d.oldVersion+" to version "+d.newVersion+', but the storage "'+b.storeName+'" already exists.')}});
h.onerror=function(b){b.preventDefault();q(h.error)};h.onsuccess=function(){e(h.result);u(b)}})}function G(b,d){if(!b.db)return!0;var e=!b.db.objectStoreNames.contains(b.storeName),a=b.version>b.db.version;return(b.version<b.db.version&&(b.version!==d&&console.warn('The database "'+b.name+"\" can't be downgraded from version "+b.db.version+" to version "+b.version+"."),b.version=b.db.version),a||e)?(e&&(d=b.db.version+1,d>b.version&&(b.version=d)),!0):!1}function ka(b){return new n(function(d,e){var a=
new FileReader;a.onerror=e;a.onloadend=function(e){e=btoa(e.target.result||"");d({__local_forage_encoded_blob:!0,data:e,type:b.type})};a.readAsBinaryString(b)})}function X(b){for(var d=atob(b.data),e=d.length,a=new ArrayBuffer(e),k=new Uint8Array(a),h=0;h<e;h++)k[h]=d.charCodeAt(h);return r([a],{type:b.type})}function la(b){var d=this,e=d._initReady().then(function(){var b=x[d._dbInfo.name];if(b&&b.dbReady)return b.dbReady});return t(e,b,b),e}function O(b){w(b);for(var d=x[b.name],e=d.forages,a=0;a<
e.length;a++){var k=e[a];k._dbInfo.db&&(k._dbInfo.db.close(),k._dbInfo.db=null)}return b.db=null,A(b,!1).then(function(d){return b.db=d,G(b)?A(b,!0):d}).then(function(a){b.db=d.db=a;for(var h=0;h<e.length;h++)e[h]._dbInfo.db=a}).catch(function(d){throw D(b,d),d;})}function z(b,d,e,a){void 0===a&&(a=1);try{var q=b.db.transaction(b.storeName,d);e(null,q)}catch(h){if(0<a&&(!b.db||"InvalidStateError"===h.name||"NotFoundError"===h.name))return n.resolve().then(function(){if(!b.db||"NotFoundError"===h.name&&
!b.db.objectStoreNames.contains(b.storeName)&&b.version<=b.db.version)return b.db&&(b.version=b.db.version+1),A(b,!0)}).then(function(){return O(b).then(function(){z(b,d,e,a-1)})}).catch(e);e(h)}}function Z(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Y(b){var d=.75*b.length;var e=b.length,a=0;"="===b[b.length-1]&&(d--,"="===b[b.length-2]&&d--);var k=new ArrayBuffer(d),h=new Uint8Array(k);for(d=0;d<e;d+=4){var c=C.indexOf(b[d]);var da=C.indexOf(b[d+1]);var y=C.indexOf(b[d+
2]);var f=C.indexOf(b[d+3]);h[a++]=c<<2|da>>4;h[a++]=(15&da)<<4|y>>2;h[a++]=(3&y)<<6|63&f}return k}function P(b){var d=new Uint8Array(b),e="";for(b=0;b<d.length;b+=3)e+=C[d[b]>>2],e+=C[(3&d[b])<<4|d[b+1]>>4],e+=C[(15&d[b+1])<<2|d[b+2]>>6],e+=C[63&d[b+2]];return 2==d.length%3?e=e.substring(0,e.length-1)+"=":1==d.length%3&&(e=e.substring(0,e.length-2)+"=="),e}function ba(b,d,e,a){b.executeSql("CREATE TABLE IF NOT EXISTS "+d.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],e,a)}function B(b,
d,e,a,k,h){b.executeSql(e,a,k,function(b,q){q.code===q.SYNTAX_ERR?b.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[d.storeName],function(b,c){c.rows.length?h(b,q):ba(b,d,function(){b.executeSql(e,a,k,h)},h)},h):h(b,q)},h)}function aa(b,d,e,q){var k=this;b=a(b);var h=new n(function(a,h){k.ready().then(function(){void 0===d&&(d=null);var c=d,f=k._dbInfo;f.serializer.serialize(d,function(d,y){y?h(y):f.db.transaction(function(e){B(e,f,"INSERT OR REPLACE INTO "+f.storeName+
" (key, value) VALUES (?, ?)",[b,d],function(){a(c)},function(b,d){h(d)})},function(d){if(d.code===d.QUOTA_ERR){if(0<q)return void a(aa.apply(k,[b,c,e,q-1]));h(d)}})})}).catch(h)});return g(h,e),h}function ma(b){return new n(function(d,e){b.transaction(function(a){a.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(e,a){e=[];for(var h=0;h<a.rows.length;h++)e.push(a.rows.item(h).name);d({db:b,storeNames:e})},function(b,d){e(d)})},function(b){e(b)})})}
function ea(b,d){var e=b.name+"/";return b.storeName!==d.storeName&&(e+=b.storeName+"/"),e}function na(b,d){b[d]=function(){var e=arguments;return b.ready().then(function(){return b[d].apply(b,e)})}}function U(){for(var b=1;b<arguments.length;b++){var d=arguments[b];if(d)for(var e in d)d.hasOwnProperty(e)&&(fa(d[e])?arguments[0][e]=d[e].slice():arguments[0][e]=d[e])}return arguments[0]}var oa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&
"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},H=function(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}();"undefined"==typeof Promise&&c(3);var n=Promise,Q="local-forage-detect-blob-support",R=void 0,x={},pa=Object.prototype.toString,
L="readwrite";c={_driver:"asyncStorage",_initStorage:function(b){function d(){return n.resolve()}var e=this,a={db:null};if(b)for(var k in b)a[k]=b[k];var h=x[a.name];h||(h=Z(),x[a.name]=h);h.forages.push(e);e._initReady||(e._initReady=e.ready,e.ready=la);b=[];for(k=0;k<h.forages.length;k++){var c=h.forages[k];c!==e&&b.push(c._initReady().catch(d))}var f=h.forages.slice(0);return n.all(b).then(function(){return a.db=h.db,A(a,!1)}).then(function(b){return a.db=b,G(a,e._defaultConfig.version)?A(a,!0):
b}).then(function(b){a.db=h.db=b;e._dbInfo=a;for(b=0;b<f.length;b++){var d=f[b];d!==e&&(d._dbInfo.db=a.db,d._dbInfo.version=a.version)}})},_support:function(){try{if(!H)return!1;var b="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),d="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!b||d)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),
iterate:function(b,d){var e=this,a=new n(function(d,a){e.ready().then(function(){z(e._dbInfo,"readonly",function(h,q){if(h)return a(h);try{var c=q.objectStore(e._dbInfo.storeName).openCursor(),k=1;c.onsuccess=function(){var e=c.result;if(e){var a=e.value;a&&a.__local_forage_encoded_blob&&(a=X(a));a=b(a,e.key,k++);void 0!==a?d(a):e.continue()}else d()};c.onerror=function(){a(c.error)}}catch(S){a(S)}})}).catch(a)});return g(a,d),a},getItem:function(b,d){var e=this;b=a(b);var c=new n(function(d,a){e.ready().then(function(){z(e._dbInfo,
"readonly",function(h,c){if(h)return a(h);try{var k=c.objectStore(e._dbInfo.storeName).get(b);k.onsuccess=function(){var b=k.result;void 0===b&&(b=null);b&&b.__local_forage_encoded_blob&&(b=X(b));d(b)};k.onerror=function(){a(k.error)}}catch(I){a(I)}})}).catch(a)});return g(c,d),c},setItem:function(b,d,e){var c=this;b=a(b);var k=new n(function(e,a){var h;c.ready().then(function(){return h=c._dbInfo,"[object Blob]"===pa.call(d)?K(h.db).then(function(b){return b?d:ka(d)}):d}).then(function(d){z(c._dbInfo,
L,function(h,k){if(h)return a(h);try{var q=k.objectStore(c._dbInfo.storeName);null===d&&(d=void 0);var f=q.put(d,b);k.oncomplete=function(){void 0===d&&(d=null);e(d)};k.onabort=k.onerror=function(){a(f.error?f.error:f.transaction.error)}}catch(T){a(T)}})}).catch(a)});return g(k,e),k},removeItem:function(b,d){var e=this;b=a(b);var c=new n(function(d,a){e.ready().then(function(){z(e._dbInfo,L,function(h,c){if(h)return a(h);try{var k=c.objectStore(e._dbInfo.storeName).delete(b);c.oncomplete=function(){d()};
c.onerror=function(){a(k.error)};c.onabort=function(){a(k.error?k.error:k.transaction.error)}}catch(I){a(I)}})}).catch(a)});return g(c,d),c},clear:function(b){var d=this,a=new n(function(b,a){d.ready().then(function(){z(d._dbInfo,L,function(e,c){if(e)return a(e);try{var h=c.objectStore(d._dbInfo.storeName).clear();c.oncomplete=function(){b()};c.onabort=c.onerror=function(){a(h.error?h.error:h.transaction.error)}}catch(y){a(y)}})}).catch(a)});return g(a,b),a},length:function(b){var d=this,a=new n(function(b,
a){d.ready().then(function(){z(d._dbInfo,"readonly",function(e,c){if(e)return a(e);try{var h=c.objectStore(d._dbInfo.storeName).count();h.onsuccess=function(){b(h.result)};h.onerror=function(){a(h.error)}}catch(y){a(y)}})}).catch(a)});return g(a,b),a},key:function(b,d){var a=this,c=new n(function(d,e){if(0>b)return void d(null);a.ready().then(function(){z(a._dbInfo,"readonly",function(c,h){if(c)return e(c);try{var k=!1,q=h.objectStore(a._dbInfo.storeName).openCursor();q.onsuccess=function(){var a=
q.result;if(!a)return void d(null);0===b?d(a.key):k?d(a.key):(k=!0,a.advance(b))};q.onerror=function(){e(q.error)}}catch(S){e(S)}})}).catch(e)});return g(c,d),c},keys:function(b){var d=this,a=new n(function(b,a){d.ready().then(function(){z(d._dbInfo,"readonly",function(e,c){if(e)return a(e);try{var h=c.objectStore(d._dbInfo.storeName).openCursor(),k=[];h.onsuccess=function(){var d=h.result;if(!d)return void b(k);k.push(d.key);d.continue()};h.onerror=function(){a(h.error)}}catch(I){a(I)}})}).catch(a)});
return g(a,b),a},dropInstance:function(b,d){d=m.apply(this,arguments);var a=this.config();b="function"!=typeof b&&b||{};b.name||(b.name=b.name||a.name,b.storeName=b.storeName||a.storeName);b.name?(a=b.name===a.name&&this._dbInfo.db?n.resolve(this._dbInfo.db):A(b,!1).then(function(a){var d=x[b.name],e=d.forages;d.db=a;for(d=0;d<e.length;d++)e[d]._dbInfo.db=a;return a}),a=b.storeName?a.then(function(a){if(a.objectStoreNames.contains(b.storeName)){var d=a.version+1;w(b);var e=x[b.name],c=e.forages;a.close();
for(a=0;a<c.length;a++){var f=c[a];f._dbInfo.db=null;f._dbInfo.version=d}return(new n(function(a,e){var c=H.open(b.name,d);c.onerror=function(b){c.result.close();e(b)};c.onupgradeneeded=function(){c.result.deleteObjectStore(b.storeName)};c.onsuccess=function(){var b=c.result;b.close();a(b)}})).then(function(b){e.db=b;for(var a=0;a<c.length;a++){var d=c[a];d._dbInfo.db=b;u(d._dbInfo)}}).catch(function(a){throw(D(b,a)||n.resolve()).catch(function(){}),a;})}}):a.then(function(a){w(b);var d=x[b.name],
e=d.forages;a.close();for(a=0;a<e.length;a++)e[a]._dbInfo.db=null;return(new n(function(a,d){var e=H.deleteDatabase(b.name);e.onerror=e.onblocked=function(b){var a=e.result;a&&a.close();d(b)};e.onsuccess=function(){var b=e.result;b&&b.close();a(b)}})).then(function(b){d.db=b;for(b=0;b<e.length;b++)u(e[b]._dbInfo)}).catch(function(a){throw(D(b,a)||n.resolve()).catch(function(){}),a;})})):a=n.reject("Invalid arguments");return g(a,d),a}};var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
ha=/^~~local_forage_type~([^~]+)~/,ia=Object.prototype.toString,V={serialize:function(b,a){var d="";if(b&&(d=ia.call(b)),b&&("[object ArrayBuffer]"===d||b.buffer&&"[object ArrayBuffer]"===ia.call(b.buffer))){var c,f="__lfsc__:";b instanceof ArrayBuffer?(c=b,f+="arbf"):(c=b.buffer,"[object Int8Array]"===d?f+="si08":"[object Uint8Array]"===d?f+="ui08":"[object Uint8ClampedArray]"===d?f+="uic8":"[object Int16Array]"===d?f+="si16":"[object Uint16Array]"===d?f+="ur16":"[object Int32Array]"===d?f+="si32":
"[object Uint32Array]"===d?f+="ui32":"[object Float32Array]"===d?f+="fl32":"[object Float64Array]"===d?f+="fl64":a(Error("Failed to get type for BinaryArray")));a(f+P(c))}else if("[object Blob]"===d)d=new FileReader,d.onload=function(){var d="~~local_forage_type~"+b.type+"~"+P(this.result);a("__lfsc__:blob"+d)},d.readAsArrayBuffer(b);else try{a(JSON.stringify(b))}catch(h){console.error("Couldn't convert value into a JSON string: ",b),a(null,h)}},deserialize:function(b){if("__lfsc__:"!==b.substring(0,
9))return JSON.parse(b);var a=b.substring(13);b=b.substring(9,13);if("blob"===b&&ha.test(a)){var e=a.match(ha);var c=e[1];a=a.substring(e[0].length)}a=Y(a);switch(b){case "arbf":return a;case "blob":return r([a],{type:c});case "si08":return new Int8Array(a);case "ui08":return new Uint8Array(a);case "uic8":return new Uint8ClampedArray(a);case "si16":return new Int16Array(a);case "ur16":return new Uint16Array(a);case "si32":return new Int32Array(a);case "ui32":return new Uint32Array(a);case "fl32":return new Float32Array(a);
case "fl64":return new Float64Array(a);default:throw Error("Unkown type: "+b);}},stringToBuffer:Y,bufferToString:P};l={_driver:"webSQLStorage",_initStorage:function(b){var a=this,e={db:null};if(b)for(var c in b)e[c]="string"!=typeof b[c]?b[c].toString():b[c];b=new n(function(b,d){try{e.db=openDatabase(e.name,String(e.version),e.description,e.size)}catch(ca){return d(ca)}e.db.transaction(function(c){ba(c,e,function(){a._dbInfo=e;b()},function(b,a){d(a)})},d)});return e.serializer=V,b},_support:"function"==
typeof openDatabase,iterate:function(b,a){var d=this,c=new n(function(a,e){d.ready().then(function(){var c=d._dbInfo;c.db.transaction(function(d){B(d,c,"SELECT * FROM "+c.storeName,[],function(d,e){d=e.rows;e=d.length;for(var h=0;h<e;h++){var f=d.item(h),k=f.value;if(k&&(k=c.serializer.deserialize(k)),void 0!==(k=b(k,f.key,h+1)))return void a(k)}a()},function(b,a){e(a)})})}).catch(e)});return g(c,a),c},getItem:function(b,d){var e=this;b=a(b);var c=new n(function(a,d){e.ready().then(function(){var c=
e._dbInfo;c.db.transaction(function(e){B(e,c,"SELECT * FROM "+c.storeName+" WHERE key = ? LIMIT 1",[b],function(b,d){(b=d.rows.length?d.rows.item(0).value:null)&&(b=c.serializer.deserialize(b));a(b)},function(b,a){d(a)})})}).catch(d)});return g(c,d),c},setItem:function(b,a,e){return aa.apply(this,[b,a,e,1])},removeItem:function(b,d){var e=this;b=a(b);var c=new n(function(a,d){e.ready().then(function(){var c=e._dbInfo;c.db.transaction(function(e){B(e,c,"DELETE FROM "+c.storeName+" WHERE key = ?",[b],
function(){a()},function(b,a){d(a)})})}).catch(d)});return g(c,d),c},clear:function(b){var a=this,e=new n(function(b,d){a.ready().then(function(){var e=a._dbInfo;e.db.transaction(function(a){B(a,e,"DELETE FROM "+e.storeName,[],function(){b()},function(b,a){d(a)})})}).catch(d)});return g(e,b),e},length:function(b){var a=this,e=new n(function(b,d){a.ready().then(function(){var e=a._dbInfo;e.db.transaction(function(a){B(a,e,"SELECT COUNT(key) as c FROM "+e.storeName,[],function(a,d){a=d.rows.item(0).c;
b(a)},function(b,a){d(a)})})}).catch(d)});return g(e,b),e},key:function(b,a){var d=this,c=new n(function(a,e){d.ready().then(function(){var c=d._dbInfo;c.db.transaction(function(d){B(d,c,"SELECT key FROM "+c.storeName+" WHERE id = ? LIMIT 1",[b+1],function(b,d){b=d.rows.length?d.rows.item(0).key:null;a(b)},function(b,a){e(a)})})}).catch(e)});return g(c,a),c},keys:function(b){var a=this,e=new n(function(b,d){a.ready().then(function(){var e=a._dbInfo;e.db.transaction(function(a){B(a,e,"SELECT key FROM "+
e.storeName,[],function(a,d){a=[];for(var e=0;e<d.rows.length;e++)a.push(d.rows.item(e).key);b(a)},function(b,a){d(a)})})}).catch(d)});return g(e,b),e},dropInstance:function(b,a){a=m.apply(this,arguments);var d=this.config();b="function"!=typeof b&&b||{};b.name||(b.name=b.name||d.name,b.storeName=b.storeName||d.storeName);var c,f=this;return c=b.name?(new n(function(a){var e=b.name===d.name?f._dbInfo.db:openDatabase(b.name,"","",0);a(b.storeName?{db:e,storeNames:[b.storeName]}:ma(e))})).then(function(b){return new n(function(a,
d){b.db.transaction(function(e){function c(b){return new n(function(a,d){e.executeSql("DROP TABLE IF EXISTS "+b,[],function(){a()},function(b,a){d(a)})})}for(var f=[],h=0,k=b.storeNames.length;h<k;h++)f.push(c(b.storeNames[h]));n.all(f).then(function(){a()}).catch(function(b){d(b)})},function(b){d(b)})})}):n.reject("Invalid arguments"),g(c,a),c}};try{var E="undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(b){E=!1}var qa=function(b,a){for(var d=b.length,c=0;c<
d;){var f=b[c],h=a;if(f===h||"number"==typeof f&&"number"==typeof h&&isNaN(f)&&isNaN(h))return!0;c++}return!1},fa=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)},J={},ja={},F={INDEXEDDB:c,WEBSQL:l,LOCALSTORAGE:{_driver:"localStorageWrapper",_initStorage:function(b){var a={};if(b)for(var e in b)a[e]=b[e];a.keyPrefix=ea(b,this._defaultConfig);try{var c=(localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1)}catch(k){c=
!0}return!c||0<localStorage.length?(this._dbInfo=a,a.serializer=V,n.resolve()):n.reject()},_support:E,iterate:function(b,a){var d=this,c=d.ready().then(function(){for(var a=d._dbInfo,e=a.keyPrefix,c=e.length,f=localStorage.length,g=1,m=0;m<f;m++){var q=localStorage.key(m);if(0===q.indexOf(e)){var l=localStorage.getItem(q);if(l&&(l=a.serializer.deserialize(l)),void 0!==(l=b(l,q.substring(c),g++)))return l}}});return g(c,a),c},getItem:function(b,d){var e=this;b=a(b);var c=e.ready().then(function(){var a=
e._dbInfo,d=localStorage.getItem(a.keyPrefix+b);return d&&(d=a.serializer.deserialize(d)),d});return g(c,d),c},setItem:function(b,d,e){var c=this;b=a(b);var f=c.ready().then(function(){void 0===d&&(d=null);var a=d;return new n(function(e,f){var h=c._dbInfo;h.serializer.serialize(d,function(d,c){if(c)f(c);else try{localStorage.setItem(h.keyPrefix+b,d),e(a)}catch(M){"QuotaExceededError"!==M.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==M.name||f(M),f(M)}})})});return g(f,e),f},removeItem:function(b,d){var e=
this;b=a(b);var c=e.ready().then(function(){localStorage.removeItem(e._dbInfo.keyPrefix+b)});return g(c,d),c},clear:function(a){var b=this,e=b.ready().then(function(){for(var a=b._dbInfo.keyPrefix,d=localStorage.length-1;0<=d;d--){var e=localStorage.key(d);0===e.indexOf(a)&&localStorage.removeItem(e)}});return g(e,a),e},length:function(a){var b=this.keys().then(function(a){return a.length});return g(b,a),b},key:function(a,d){var b=this,c=b.ready().then(function(){var d=b._dbInfo;try{var e=localStorage.key(a)}catch(ca){e=
null}return e&&(e=e.substring(d.keyPrefix.length)),e});return g(c,d),c},keys:function(a){var b=this,e=b.ready().then(function(){for(var a=b._dbInfo,d=localStorage.length,e=[],c=0;c<d;c++){var f=localStorage.key(c);0===f.indexOf(a.keyPrefix)&&e.push(f.substring(a.keyPrefix.length))}return e});return g(e,a),e},dropInstance:function(a,d){if(d=m.apply(this,arguments),a="function"!=typeof a&&a||{},!a.name){var b=this.config();a.name=a.name||b.name;a.storeName=a.storeName||b.storeName}var c,f=this;return c=
a.name?(new n(function(b){b(a.storeName?ea(a,f._defaultConfig):a.name+"/")})).then(function(a){for(var b=localStorage.length-1;0<=b;b--){var d=localStorage.key(b);0===d.indexOf(a)&&localStorage.removeItem(d)}}):n.reject("Invalid arguments"),g(c,d),c}}};E=[F.INDEXEDDB._driver,F.WEBSQL._driver,F.LOCALSTORAGE._driver];var N=["dropInstance"],W="clear getItem iterate key keys length removeItem setItem".split(" ").concat(N),ra={description:"",driver:E.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",
version:1};E=new (function(){function a(b){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");for(var d in F)if(F.hasOwnProperty(d)){var c=F[d],f=c._driver;this[d]=f;J[f]||this.defineDriver(c)}this._defaultConfig=U({},ra);this._config=U({},this._defaultConfig,b);this._initDriver=this._driverSet=null;this._ready=!1;this._dbInfo=null;this._wrapLibraryMethodsWithReady();this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(a){if("object"===
(void 0===a?"undefined":oa(a))){if(this._ready)return Error("Can't call config() after localforage has been used.");for(var b in a){if("storeName"===b&&(a[b]=a[b].replace(/\W/g,"_")),"version"===b&&"number"!=typeof a[b])return Error("Database version must be a number.");this._config[b]=a[b]}return!("driver"in a&&a.driver)||this.setDriver(this._config.driver)}return"string"==typeof a?this._config[a]:this._config},a.prototype.defineDriver=function(a,b,c){var d=new n(function(b,d){try{var c=a._driver,
e=Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!a._driver)return void d(e);for(var f=W.concat("_initStorage"),h=0,m=f.length;h<m;h++){var k=f[h];if((!qa(N,k)||a[k])&&"function"!=typeof a[k])return void d(e)}(function(){for(var b=function(a){return function(){var b=n.reject(Error("Method "+a+" is not implemented by the current driver"));return g(b,arguments[arguments.length-1]),b}},d=0,c=N.length;d<c;d++){var e=N[d];a[e]||(a[e]=b(e))}})();e=function(d){J[c]&&
console.info("Redefining LocalForage driver: "+c);J[c]=a;ja[c]=d;b()};"_support"in a?a._support&&"function"==typeof a._support?a._support().then(e,d):e(!!a._support):e(!0)}catch(T){d(T)}});return t(d,b,c),d},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(a,b,c){a=J[a]?n.resolve(J[a]):n.reject(Error("Driver not found."));return t(a,b,c),a},a.prototype.getSerializer=function(a){var b=n.resolve(V);return t(b,a),b},a.prototype.ready=function(a){var b=this,d=b._driverSet.then(function(){return null===
b._ready&&(b._ready=b._initDriver()),b._ready});return t(d,a,a),d},a.prototype.setDriver=function(a,b,c){function d(){g._config.driver=g.driver()}function e(a){return g._extend(a),d(),g._ready=g._initStorage(g._config),g._ready}function f(a){return function(){function b(){for(;c<a.length;){var f=a[c];return c++,g._dbInfo=null,g._ready=null,g.getDriver(f).then(e).catch(b)}d();return g._driverSet=n.reject(Error("No available storage method found.")),g._driverSet}var c=0;return b()}}var g=this;fa(a)||
(a=[a]);var m=this._getSupportedDrivers(a);return this._driverSet=(null!==this._driverSet?this._driverSet.catch(function(){return n.resolve()}):n.resolve()).then(function(){var a=m[0];return g._dbInfo=null,g._ready=null,g.getDriver(a).then(function(a){g._driver=a._driver;d();g._wrapLibraryMethodsWithReady();g._initDriver=f(m)})}).catch(function(){d();return g._driverSet=n.reject(Error("No available storage method found.")),g._driverSet}),t(this._driverSet,b,c),this._driverSet},a.prototype.supports=
function(a){return!!ja[a]},a.prototype._extend=function(a){U(this,a)},a.prototype._getSupportedDrivers=function(a){for(var b=[],d=0,c=a.length;d<c;d++){var f=a[d];this.supports(f)&&b.push(f)}return b},a.prototype._wrapLibraryMethodsWithReady=function(){for(var a=0,b=W.length;a<b;a++)na(this,W[a])},a.prototype.createInstance=function(b){return new a(b)},a}());f.exports=E},{3:3}]},{},[4])(4)});
let dbrStoreConsumption,dbrStoreLicenseInfo,dbrBSendSmallRecordsForDebug,dbrSessionDuration,dbrNextPostConsumptionTime=-Infinity,dbrNextTaskId=0,dbrTaskCallbackMap=new Map,dbrAESGCMKey,dbrFuncGenAESGCMKey=()=>self.crypto.subtle.importKey("raw",new Uint8Array([80,88,27,82,145,164,199,211,187,87,89,128,150,44,190,213,99,181,118,158,215,103,76,117,29,83,122,137,5,180,157,114]),"AES-GCM",!0,["encrypt","decrypt"]),dbrFuncDecryptAndAtob=async p=>{if(self.crypto){var c=atob(p),f=new Uint8Array(c.length);
for(let l=0;l<c.length;++l)f[l]=c.charCodeAt(l);c=f.subarray(0,12);f=f.subarray(c.length);dbrAESGCMKey||(dbrAESGCMKey=await dbrFuncGenAESGCMKey());f=await self.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:128},dbrAESGCMKey,f);return String.fromCharCode.apply(null,new Uint8Array(f))}return await new Promise((c,f)=>{let g=dbrNextTaskId++;dbrTaskCallbackMap.set(g,g=>{if(g.success)return dbrBWasmDebug&&console.log(g.txt),c(g.txt);{let a=Error(g.message);a.stack+="\n"+g.stack;return f(a)}});postMessage({type:"taskd",
taskID:g,txt:p})})},dbrFuncEncryptAndBtoa=async p=>{if(self.crypto){var c=new Uint8Array(p.length);for(var f=0;f<p.length;++f)c[f]=p.charCodeAt(f);f=self.crypto.getRandomValues(new Uint8Array(12));dbrAESGCMKey||(dbrAESGCMKey=await dbrFuncGenAESGCMKey());c=await self.crypto.subtle.encrypt({name:"AES-GCM",iv:f,tagLength:128},dbrAESGCMKey,c);c=new Uint8Array(c);let l=new Uint8Array(f.length+c.length);l.set(f);l.set(c,f.length);return btoa(String.fromCharCode.apply(null,l))}return await new Promise((c,
f)=>{let g=dbrNextTaskId++;dbrTaskCallbackMap.set(g,g=>{if(g.success)return dbrBWasmDebug&&console.log(g.txt),c(g.txt);{let a=Error(g.message);a.stack+="\n"+g.stack;return f(a)}});postMessage({type:"taske",taskID:g,txt:p})})};
var Module={locateFile:function(p){return"libDynamsoftBarcodeReader.wasm"==p?dbrEngineResourcePath+"dbr-"+dbrVersion+(dbrBUseFullFeature?".full":"")+".wasm":dbrEngineResourcePath+p},printErr:console.error,onRuntimeInitialized:async function(){postMessage({type:"log",message:"wasm initialized"});let p={productKeys:dbrProductKeys,domain:dbrDomain};dbrBWasmDebug&&(p.bDebug=!0);if(dbrBRuntimeKeys){await dbrPromiseGetLicense;let c=dbrLicenseInfo;if(c instanceof Error){postMessage({type:"load",success:!1,
message:c.message,stack:c.stack});setTimeout(()=>{throw c;},0);return}if(!c.productKeys){postMessage({type:"load",success:!1,message:c.message,stack:""});return}dbrSessionDuration=1E3*c.sessionDuration;p.runtimeKeys=dbrProductKeys;p.productKeys=c.productKeys;p.consumeType=c.consumeType;p.urlGetLicense="";p.aryUrlPostConsume=p.sm_aryUrlPostConsume=[];p.bNewDevice=dbrBNewDevice;p.uuid=dbrUUID;p.initTime=Date.now().toString();sendConsume();setInterval(sendConsume,dbrSessionDuration)}Module.BarcodeReaderWasm.init(JSON.stringify(p));
postMessage({type:"load",success:!0,version:Module.BarcodeReaderWasm.getVersion()})}};let DBR_MapInstances=new Map,nextInstanceID=0;
onmessage=async function(p){var c=p.data,f=c.id,l=c.instanceID;const r=c.body;switch(c.type){case "loadWasm":dbrBWasmDebug=c.bWasmDebug;dbrEngineResourcePath=c.engineResourcePath;dbrVersion=c.version;dbrProductKeys=c.productKeys;dbrDomain=c.domain;dbrBUseFullFeature=c.bUseFullFeature;dbrUUID=c.uuid;dbrLicenseServer=c.licenseServer?c.licenseServer:dbrLicenseServer;dbrBSendSmallRecordsForDebug=c.bSendSmallRecordsForDebug;importScripts(dbrEngineResourcePath+"dbr-"+dbrVersion+(dbrBUseFullFeature?".full":
"")+".wasm.js");if(dbrBRuntimeKeys=8==dbrProductKeys.length)dbrStoreLicenseInfo=await localforage.createInstance({name:"dbrjsLicenseInfo"}),dbrStoreConsumption=await localforage.createInstance({name:"dbrjs"+dbrProductKeys+"unsV2"}),dbrBNewDevice=!await dbrStoreLicenseInfo.getItem(dbrProductKeys+"old"),dbrPromiseGetLicense=(async()=>{let a;var c=await dbrStoreLicenseInfo.getItem(dbrProductKeys);c&&([c,a]=c,Date.now()>c&&(await dbrStoreLicenseInfo.removeItem(dbrProductKeys),a=null));try{await Promise.race([fetch(dbrLicenseServer+
"api/verification/"+dbrProductKeys).then(a=>{if(a.ok)return a.text();throw Error("Network Error. Can't get license.");}).then(c=>{a=c;return dbrStoreLicenseInfo.setItem(dbrProductKeys,[Date.now()+6048E5,a])}),new Promise((c,f)=>{setTimeout(()=>f(Error("Network Error. Request timeout.")),a?3E3:15E3)})])}catch(v){if(dbrBWasmDebug&&console.error(v),null==a){dbrLicenseInfo=v;return}}dbrLicenseInfo=await dbrFuncDecryptAndAtob(a).then(a=>JSON.parse(a))})();break;case "createInstance":l=nextInstanceID++;
try{let a=new Module.BarcodeReaderWasm(c.bScanner,l);DBR_MapInstances.set(l,a);if(c.bScanner||!dbrBUseFullFeature){let f=JSON.parse(a.getRuntimeSettings());c.bScanner&&(f.localizationModes=[2,0,0,0,0,0,0,0],f.deblurLevel=2);dbrBUseFullFeature||(f.barcodeFormatIds=234882047);a.updateRuntimeSettings(JSON.stringify(f))}}catch(a){handleErr(a,f);break}postMessage({type:"task",id:f,body:{success:!0,instanceID:l}});break;case "destroy":try{DBR_MapInstances.get(l).delete(),DBR_MapInstances.delete(l)}catch(a){handleErr(a,
f);break}postMessage({type:"task",id:f,body:{success:!0}});break;case "decodeBuffer":{let a;try{a=JSON.parse(DBR_MapInstances.get(l).decodeBuffer(r.buffer,r.width,r.height,r.stride,r.format))}catch(m){handleErr(m,f);break}postMessage({type:"task",id:f,body:{success:!0,decodeReturn:a}});break}case "getRuntimeSettings":{let a;try{a=DBR_MapInstances.get(l).getRuntimeSettings()}catch(m){handleErr(m,f);break}postMessage({type:"task",id:f,body:{success:!0,results:a}});break}case "updateRuntimeSettings":try{DBR_MapInstances.get(l).updateRuntimeSettings(r.settings)}catch(a){handleErr(a,
f);break}postMessage({type:"task",id:f,body:{success:!0}});break;case "resetRuntimeSettings":try{DBR_MapInstances.get(l).resetRuntimeSettings()}catch(a){handleErr(p,f);break}this.postMessage({type:"task",id:f,body:{success:!0}});break;case "outputSettingsToString":{let a;try{a=DBR_MapInstances.get(l).outputSettingsToString()}catch(m){handleErr(m,f);break}postMessage({type:"task",id:f,body:{success:!0,results:a}});break}case "initRuntimeSettingsWithString":try{DBR_MapInstances.get(l).initRuntimeSettingsWithString(r.settings)}catch(a){handleErr(a,
f);break}postMessage({type:"task",id:f,body:{success:!0}});break;case "getIntermediateResults":{let a=null;try{var g=DBR_MapInstances.get(l).getIntermediateResults(),t=JSON.parse(g,(c,f)=>"bytes"===c&&"ptr"in f&&"length"in f?a=Module.BarcodeReaderWasm.getBytes(f.ptr,f.length):f);DBR_MapInstances.get(l).freeIntermediateResults()}catch(m){handleErr(m,f);break}this.postMessage({type:"task",id:f,body:{success:!0,results:t}});break}case "setModeArgument":try{DBR_MapInstances.get(l).setModeArgument(r.modeName,
r.index,r.argumentName,r.argumentValue)}catch(a){handleErr(a,f);break}this.postMessage({type:"task",id:f,body:{success:!0}});break;case "updateScanSettings":try{let a=DBR_MapInstances.get(l),c=r.settings;a.duplicateForgetTime=c.duplicateForgetTime;a.oneDRememberFrameCount=c.oneDRememberFrameCount;a.oneDTrustFrameCount=c.oneDTrustFrameCount;c.frameFilter?a.setFrameFilter(JSON.stringify(c.frameFilter)):a.setFrameFilter("")}catch(a){handleErr(a,f);break}this.postMessage({type:"task",id:f,body:{success:!0}});
break;case "getScanSettings":c={};try{let a=DBR_MapInstances.get(l);c.duplicateForgetTime=a.duplicateForgetTime;c.oneDRememberFrameCount=a.oneDRememberFrameCount;c.oneDTrustFrameCount=a.oneDTrustFrameCount;let f=a.getFrameFilter();f&&(c.frameFilter=JSON.parse(f))}catch(a){handleErr(a,f);break}this.postMessage({type:"task",id:f,body:{success:!0,results:c}});break;case "task":f=c.id;c=c.body;try{dbrTaskCallbackMap.get(f)(c),dbrTaskCallbackMap.delete(f)}catch(a){throw dbrTaskCallbackMap.delete(f),a;
}break;default:console.warn("Unmatched task: ",p)}};
let handleErr=(p,c)=>{postMessage({type:"task",id:c,body:{success:!1,message:p.message,stack:p.stack}});setTimeout(()=>{throw p;},0)},addConsumeRecordToDB=async p=>{dbrBWasmDebug&&console.log("%c","color:#0f0",atob(p));await dbrStoreConsumption.setItem(Date.now().toString(),p);dbrNextPostConsumptionTime<Date.now()&&(dbrNextPostConsumptionTime=Date.now()+dbrSessionDuration,sendConsume())},sendConsume=async()=>{dbrPromisePostConsumption=dbrPromisePostConsumption.then(async()=>{var p=Date.now();let c=
await dbrStoreConsumption.keys();if(c.length){dbrBWasmDebug&&console.log("get keys to filter for send: %o",c);var f=[],l=new Map;for(let g of c){let c=JSON.parse(atob(await dbrStoreConsumption.getItem(g))),a;dbrBNewDevice?(dbrBNewDevice=!1,await dbrStoreLicenseInfo.setItem(dbrProductKeys+"old",dbrUUID),a=Math.floor(c.decodeTime/dbrSessionDuration)*dbrSessionDuration):a=Math.ceil(c.decodeTime/dbrSessionDuration)*dbrSessionDuration;dbrBSendSmallRecordsForDebug&&(a=parseInt(c.decodeTime));dbrBWasmDebug&&
console.log("timeKey: %d, dateNow: %d",a,p);if(a>p)continue;f.push(g);let m=l.has(a)?l.get(a):{all:0,oned:0,qr:0,pdf417:0,dm:0,mc:0,other:0};m.all+=c.consumption.all;m.oned+=c.consumption.oned;m.qr+=c.consumption.qr;m.pdf417+=c.consumption.pdf417;m.dm+=c.consumption.dm;m.mc+=c.consumption.mc;m.other+=c.consumption.other;l.set(a,m)}if(f.length){dbrBWasmDebug&&console.log("get keys for send: %o",c);dbrNextPostConsumptionTime=p+dbrSessionDuration;var r=[];l.forEach((c,f)=>{r.push({recordTime:f,consumption:c})});
p={version:"2",runtimeKeys:dbrProductKeys,uuid:dbrUUID,postTime:Date.now(),records:r};dbrBWasmDebug&&dbrBWasmDebug&&console.log(p);await fetch(dbrLicenseServer+"api/verification",{mode:"cors",method:"POST",body:await dbrFuncEncryptAndBtoa(JSON.stringify(p))}).then(async c=>{if(c.ok)for(let c of f)await dbrStoreConsumption.removeItem(c)},c=>{console.error(c)})}}})};
