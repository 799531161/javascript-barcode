<!DOCTYPE html>
<html>
<body>
    <p>Loading...</p>
    <p>Please check if there are any remaining cameras available for connection.</p>
    <p>
        Opening the camera at a non-secure site may fail.
        Please refer to <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Security" target="_blank">this</a>
        for more info.
    </p>
    <!--Please visit https://www.dynamsoft.com/CustomerPortal/Portal/TrialLicense.aspx to get trial license. -->
    <script src="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@7.2.2-v2/dist/dbr.js" data-productKeys="t0068NQAAAEinQx04HqNpNeDnStDS82GVM0jXaVEB5QLwvS3zhtoBKZHV3rRgtm599m9NCQ2QeBrf9LaB54Le1ulU4yghANo="></script>
 
    <script>
        // Dynamsoft.BarcodeReader._bUseFullFeature = true; // Control of loading min wasm or full wasm.
        let scanner = null;
        Dynamsoft.BarcodeScanner.createInstance({
            onFrameRead: results => {console.log(results);},
            onUnduplicatedRead: (txt, result) => {alert(txt);}
        }).then(async s => {
            scanner = s;
            await usePresetRuntimeSettings(s, "balance");
            scanner.show().catch(ex=>{
                console.log(ex);
                alert(ex.message || ex);
                scanner.hide();
            });
        });

        let usePresetRuntimeSettings = async (reader, mode) => {
            await reader.resetRuntimeSettings();
            let settings = await reader.getRuntimeSettings();

            switch(mode.toLowerCase()){
            case "bestcoverage":
                settings.deblurLevel = 9;
                settings.expectedBarcodesCount = 512;
                settings.scaleDownThreshold = 100000;
                settings.localizationModes = [
                    Dynamsoft.EnumLocalizationMode.LM_CONNECTED_BLOCKS,
                    Dynamsoft.EnumLocalizationMode.LM_SCAN_DIRECTLY,
                    Dynamsoft.EnumLocalizationMode.LM_STATISTICS,
                    Dynamsoft.EnumLocalizationMode.LM_LINES,
                    0,0,0,0
                ];
                if(Dynamsoft.BarcodeReader._bUseFullFeature){
                    settings.localizationModes[4] = Dynamsoft.EnumLocalizationMode.LM_STATISTICS_MARKS;
                }
                settings.furtherModes.grayscaleTransformationModes = [
                    Dynamsoft.EnumGrayscaleTransformationMode.GTM_ORIGINAL, 
                    Dynamsoft.EnumGrayscaleTransformationMode.GTM_INVERTED,
                    0,0,0,0,0,0
                ];
                break;
            case "bestspeed":
                settings.deblurLevel = 3;
                settings.expectedBarcodesCount = 512;
                settings.localizationModes = [
                    Dynamsoft.EnumLocalizationMode.LM_SCAN_DIRECTLY,
                    0,0,0,0,0,0,0
                ];
                break;
            case "balance":
                settings.deblurLevel = 5;
                settings.expectedBarcodesCount = 512;
                settings.localizationModes = [
                    Dynamsoft.EnumLocalizationMode.LM_CONNECTED_BLOCKS,
                    Dynamsoft.EnumLocalizationMode.LM_SCAN_DIRECTLY,
                    0,0,0,0,0,0,0
                ];
                break;
            }

            await reader.updateRuntimeSettings(settings);
        };
    </script>
</body>
</html>